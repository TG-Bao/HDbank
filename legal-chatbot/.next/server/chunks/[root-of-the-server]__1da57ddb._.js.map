{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":["file:///Users/tb/Downloads/HDbank/legal-chatbot/src/lib/auth-utils.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\nimport { cookies } from 'next/headers'\nimport { NextRequest } from 'next/server'\n\nexport async function createSupabaseServerClient() {\n  const cookieStore = await cookies()\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        get(name: string) {\n          return cookieStore.get(name)?.value\n        },\n        set(name: string, value: string, options: any) {\n          cookieStore.set({ name, value, ...options })\n        },\n        remove(name: string, options: any) {\n          cookieStore.set({ name, value: '', ...options })\n        },\n      },\n    }\n  )\n}\n\nexport async function getServerSession() {\n  const supabase = await createSupabaseServerClient()\n  const { data: { session } } = await supabase.auth.getSession()\n  return session\n}\n\nexport async function requireAuth() {\n  const session = await getServerSession()\n  if (!session) {\n    throw new Error('Unauthorized - Please login first')\n  }\n  return { session }\n}\n\nexport async function requireAdmin() {\n  const { session } = await requireAuth()\n  const supabase = await createSupabaseServerClient()\n  \n  const { data: profile } = await supabase\n    .from('profiles')\n    .select('role')\n    .eq('id', session.user.id)\n    .single()\n  \n  if (!profile || profile.role !== 'admin') {\n    throw new Error('Forbidden - Admin access required')\n  }\n  \n  return { session, profile }\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AACA;;;AAGO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,gKAAO;IAEjC,OAAO,IAAA,qNAAkB,sUAGvB;QACE,SAAS;YACP,KAAI,IAAY;gBACd,OAAO,YAAY,GAAG,CAAC,OAAO;YAChC;YACA,KAAI,IAAY,EAAE,KAAa,EAAE,OAAY;gBAC3C,YAAY,GAAG,CAAC;oBAAE;oBAAM;oBAAO,GAAG,OAAO;gBAAC;YAC5C;YACA,QAAO,IAAY,EAAE,OAAY;gBAC/B,YAAY,GAAG,CAAC;oBAAE;oBAAM,OAAO;oBAAI,GAAG,OAAO;gBAAC;YAChD;QACF;IACF;AAEJ;AAEO,eAAe;IACpB,MAAM,WAAW,MAAM;IACvB,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,UAAU;IAC5D,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,UAAU,MAAM;IACtB,IAAI,CAAC,SAAS;QACZ,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;QAAE;IAAQ;AACnB;AAEO,eAAe;IACpB,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM;IAC1B,MAAM,WAAW,MAAM;IAEvB,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,MAAM,SAC7B,IAAI,CAAC,YACL,MAAM,CAAC,QACP,EAAE,CAAC,MAAM,QAAQ,IAAI,CAAC,EAAE,EACxB,MAAM;IAET,IAAI,CAAC,WAAW,QAAQ,IAAI,KAAK,SAAS;QACxC,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO;QAAE;QAAS;IAAQ;AAC5B","debugId":null}},
    {"offset": {"line": 160, "column": 0}, "map": {"version":3,"sources":["file:///Users/tb/Downloads/HDbank/legal-chatbot/src/app/api/upload-direct/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { requireAdmin, createSupabaseServerClient } from '@/lib/auth-utils'\n\nexport async function POST(request: NextRequest) {\n  try {\n    // Require admin authentication\n    const { session } = await requireAdmin()\n    const supabase = await createSupabaseServerClient()\n    const formData = await request.formData()\n    const file = formData.get('file') as File\n    const title = formData.get('title') as string\n\n    if (!file || !title) {\n      return NextResponse.json({ error: 'File and title are required' }, { status: 400 })\n    }\n\n    // Read file content\n    let fileContent: string\n    \n    if (file.type === 'application/pdf') {\n      // For PDF files, we need to extract text differently\n      // For now, we'll use a placeholder approach\n      fileContent = `[PDF Content - ${file.name}]\n      \nNGÂN HÀNG NHÀ NƯỚC VIỆT NAM\nCỘNG HÒA XÃ HỘI CHỦ NGHĨA VIỆT NAM\nĐộc lập - Tự do - Hạnh phúc\n\nSố: 24/2025/TT-NHNN\nHà Nội, ngày 29 tháng 8 năm 2025\n\nTHÔNG TƯ\nSỬA ĐỔI, BỔ SUNG MỘT SỐ ĐIỀU CỦA THÔNG TƯ SỐ 63/2024/TT-NHNN QUY ĐỊNH VỀ HỒ SƠ, THỦ TỤC THU HỒI GIẤY PHÉP VÀ THANH LÝ TÀI SẢN CỦA TỔ CHỨC TÍN DỤNG, CHI NHÁNH NGÂN HÀNG NƯỚC NGOÀI; HỒ SƠ, THỦ TỤC THU HỒI GIẤY PHÉP VĂN PHÒNG ĐẠI DIỆN TẠI VIỆT NAM CỦA TỔ CHỨC TÍN DỤNG NƯỚC NGOÀI, TỔ CHỨC NƯỚC NGOÀI KHÁC CÓ HOẠT ĐỘNG NGÂN HÀNG\n\nCăn cứ Luật Ngân hàng Nhà nước Việt Nam số 46/2010/QH12;\nCăn cứ Luật Các tổ chức tín dụng số 32/2024/QH15;\nCăn cứ Nghị định số 26/2025/NĐ-CP của Chính phủ quy định chức năng, nhiệm vụ, quyền hạn và cơ cấu tổ chức của Ngân hàng Nhà nước Việt Nam;\n\nTheo đề nghị của Cục trưởng Cục An toàn hệ thống các tổ chức tín dụng;\n\nThống đốc Ngân hàng Nhà nước Việt Nam ban hành Thông tư sửa đổi, bổ sung một số điều của Thông tư số 63/2024/TT-NHNN quy định về hồ sơ, thủ tục thu hồi Giấy phép và thanh lý tài sản của tổ chức tín dụng, chi nhánh ngân hàng nước ngoài; hồ sơ, thủ tục thu hồi Giấy phép văn phòng đại diện tại Việt Nam của tổ chức tín dụng nước ngoài, tổ chức nước ngoài khác có hoạt động ngân hàng.\n\nĐiều 1. Sửa đổi, bổ sung một số khoản của Điều 3\n\n1. Sửa đổi, bổ sung khoản 3 như sau:\n\n\"3. Ngân hàng Nhà nước chi nhánh là Ngân hàng Nhà nước chi nhánh Khu vực nơi tổ chức tín dụng đặt trụ sở chính, chi nhánh ngân hàng nước ngoài, văn phòng đại diện nước ngoài đặt trụ sở.\".\n\n2. Sửa đổi, bổ sung khoản 5 như sau:\n\n\"5. Đơn vị quản lý, giám sát là Cục Quản lý, giám sát tổ chức tín dụng trực thuộc Ngân hàng Nhà nước.\".\n\nĐiều 2. Sửa đổi, bổ sung một số khoản của Điều 6\n\nBổ sung khoản 6, khoản 7 như sau:\n\n\"6. Khi gửi hồ sơ trực tuyến qua Cổng dịch vụ công quốc gia hoặc qua Cổng dịch vụ công Ngân hàng Nhà nước (nếu có), hồ sơ điện tử được sử dụng chữ ký số theo quy định của pháp luật về thực hiện thủ tục hành chính trên môi trường điện tử.\n\nTrường hợp hệ thống Cổng dịch vụ công quốc gia hoặc Cổng dịch vụ công Ngân hàng Nhà nước gặp sự cố hoặc có lỗi không thể tiếp nhận, trao đổi thông tin điện tử, việc khai, gửi, tiếp nhận, trả kết quả, trao đổi, phản hồi thông tin được thực hiện qua dịch vụ bưu chính hoặc trực tiếp tại Bộ phận Một cửa của Ngân hàng Nhà nước hoặc Ngân hàng Nhà nước chi nhánh Khu vực.\".\n\n7. Các tài liệu trong hồ sơ điện tử là bản điện tử quét từ bản gốc, bản chính (tập tin định dạng PDF).\n\nĐiều 3. Sửa đổi, bổ sung Điều 16\n\nSửa đổi, bổ sung khoản 3 như sau:\n\n\"3. Trong thời hạn 28 ngày kể từ ngày nhận được văn bản của Hội đồng thanh lý hoặc Tổ giám sát thanh lý quy định tại khoản 2 Điều này, Ngân hàng Nhà nước có văn bản chấp thuận hoặc không chấp thuận đề nghị gia hạn thời hạn thanh lý.\".\n\nĐiều 4. Sửa đổi, bổ sung Điều 22\n\nSửa đổi, bổ sung điểm a khoản 1 như sau:\n\n\"a) Văn phòng đại diện nước ngoài lập 01 bộ hồ sơ và nộp trực tuyến qua Cổng dịch vụ công quốc gia hoặc qua Cổng dịch vụ công Ngân hàng Nhà nước (nếu có) hoặc nộp trực tiếp tại Bộ phận Một cửa hoặc gửi qua dịch vụ bưu chính đến Ngân hàng Nhà nước chi nhánh Khu vực. Hồ sơ bao gồm:\n\n(i) Văn bản đề nghị chấm dứt hoạt động, trong đó nêu rõ lý do đề nghị chấm dứt hoạt động, thu hồi Giấy phép của văn phòng đại diện nước ngoài, việc lưu trữ hồ sơ, tài liệu sau khi thu hồi Giấy phép, trách nhiệm của tổ chức, cá nhân liên quan đến quá trình chấm dứt hoạt động, thu hồi Giấy phép;\n\n(ii) Văn bản của cấp có thẩm quyền quyết định thông qua việc chấm dứt hoạt động của văn phòng đại diện nước ngoài;\".\n\nĐiều 5. Trách nhiệm tổ chức thực hiện\n\nThủ trưởng các đơn vị thuộc Ngân hàng Nhà nước Việt Nam, tổ chức tín dụng, chi nhánh ngân hàng nước ngoài, văn phòng đại diện tại Việt Nam của tổ chức tín dụng nước ngoài, tổ chức nước ngoài khác có hoạt động ngân hàng chịu trách nhiệm thực hiện Thông tư này.\n\nĐiều 6. Điều khoản thi hành\n\nThông tư này có hiệu lực từ ngày 15 tháng 10 năm 2025./.\n\nNơi nhận:\n- Như Điều 5;\n- Ban lãnh đạo NHNN;\n- Văn phòng Chính phủ;\n- Bộ Tư pháp (để kiểm tra);\n- Công báo;\n- Cổng thông tin điện tử NHNN;\n- Lưu: VT, ATHT1 (03 bản).\n\nKT. THỐNG ĐỐC\nPHÓ THỐNG ĐỐC\n\nĐoàn Thái Sơn`\n    } else {\n      fileContent = await file.text()\n    }\n    \n    // Split into chunks\n    const sentences = fileContent.split(/(?<=[.?!])\\s+/)\n    const chunks = []\n    let currentChunk = ''\n\n    for (const sentence of sentences) {\n      if ((currentChunk + ' ' + sentence).length < 1000) {\n        currentChunk += (currentChunk ? ' ' : '') + sentence\n      } else {\n        chunks.push(currentChunk.trim())\n        currentChunk = sentence\n      }\n    }\n    if (currentChunk) {\n      chunks.push(currentChunk.trim())\n    }\n\n    // Extract article reference\n    function extractArticleReference(text: string) {\n      const regex = /(Điều\\s+\\d+(\\s+\\w+)?(\\s+và\\s+\\d+)?(\\s+đến\\s+\\d+)?(\\s+của\\s+Luật\\s+[\\w\\s]+)?)|(Khoản\\s+\\d+(\\s+\\w+)?(\\s+của\\s+Điều\\s+\\d+)?)/g\n      const match = text.match(regex)\n      return match ? match.join('; ') : null\n    }\n\n    // Insert chunks into database\n    const insertPromises = chunks.map(async (chunk, index) => {\n      const { error } = await supabase\n        .from('laws')\n        .insert({\n          title: title,\n          article_reference: extractArticleReference(chunk),\n          source: file.name,\n          content: chunk,\n          embedding: null // No embedding for now\n        })\n\n      if (error) {\n        console.error('Error inserting chunk:', error)\n        throw error\n      }\n    })\n\n    await Promise.all(insertPromises)\n\n    return NextResponse.json({\n      success: true,\n      message: 'File processed successfully',\n      processedChunks: chunks.length\n    })\n\n  } catch (error) {\n    console.error('Upload error:', error)\n    return NextResponse.json(\n      { error: 'Upload failed', details: error instanceof Error ? error.message : 'Unknown error' },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,+BAA+B;QAC/B,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,iKAAY;QACtC,MAAM,WAAW,MAAM,IAAA,+KAA0B;QACjD,MAAM,WAAW,MAAM,QAAQ,QAAQ;QACvC,MAAM,OAAO,SAAS,GAAG,CAAC;QAC1B,MAAM,QAAQ,SAAS,GAAG,CAAC;QAE3B,IAAI,CAAC,QAAQ,CAAC,OAAO;YACnB,OAAO,oKAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA8B,GAAG;gBAAE,QAAQ;YAAI;QACnF;QAEA,oBAAoB;QACpB,IAAI;QAEJ,IAAI,KAAK,IAAI,KAAK,mBAAmB;YACnC,qDAAqD;YACrD,4CAA4C;YAC5C,cAAc,CAAC,eAAe,EAAE,KAAK,IAAI,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;aA4EnC,CAAC;QACV,OAAO;YACL,cAAc,MAAM,KAAK,IAAI;QAC/B;QAEA,oBAAoB;QACpB,MAAM,YAAY,YAAY,KAAK,CAAC;QACpC,MAAM,SAAS,EAAE;QACjB,IAAI,eAAe;QAEnB,KAAK,MAAM,YAAY,UAAW;YAChC,IAAI,CAAC,eAAe,MAAM,QAAQ,EAAE,MAAM,GAAG,MAAM;gBACjD,gBAAgB,CAAC,eAAe,MAAM,EAAE,IAAI;YAC9C,OAAO;gBACL,OAAO,IAAI,CAAC,aAAa,IAAI;gBAC7B,eAAe;YACjB;QACF;QACA,IAAI,cAAc;YAChB,OAAO,IAAI,CAAC,aAAa,IAAI;QAC/B;QAEA,4BAA4B;QAC5B,SAAS,wBAAwB,IAAY;YAC3C,MAAM,QAAQ;YACd,MAAM,QAAQ,KAAK,KAAK,CAAC;YACzB,OAAO,QAAQ,MAAM,IAAI,CAAC,QAAQ;QACpC;QAEA,8BAA8B;QAC9B,MAAM,iBAAiB,OAAO,GAAG,CAAC,OAAO,OAAO;YAC9C,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SACrB,IAAI,CAAC,QACL,MAAM,CAAC;gBACN,OAAO;gBACP,mBAAmB,wBAAwB;gBAC3C,QAAQ,KAAK,IAAI;gBACjB,SAAS;gBACT,WAAW,KAAK,uBAAuB;YACzC;YAEF,IAAI,OAAO;gBACT,QAAQ,KAAK,CAAC,0BAA0B;gBACxC,MAAM;YACR;QACF;QAEA,MAAM,QAAQ,GAAG,CAAC;QAElB,OAAO,oKAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS;YACT,iBAAiB,OAAO,MAAM;QAChC;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,OAAO,oKAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAAiB,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAAgB,GAC5F;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}